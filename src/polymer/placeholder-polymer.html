<script type="text/javascript" src="../js/placeholder-vanilla.js"></script>
<polymer-element name="place-holder" attributes="pwidth pheight pratio puseratio">
	<template>
		<style type="text/css">
		:host {
        	display: inline-block;
		}
	</style>
	</template>
	<script type="text/javascript">	

		Polymer('place-holder', {
	      
			pwidth: null,
			pheight: null,
			pratio: null,
			puseratio: null,
			placeholderVanilla: null,

			ready: function() {
				
				/* 
					In the case that dimensions are being set with an inner ratio element for height, then
					lets encapsulate it in the shadow DOM instead of regular DOM. To achieve these we need
					to override the way the setRadioDimensions prototype method adds inner ratio element.
				*/

				PlaceholderVanilla.prototype.setRatioDimensions = function(widthMeasure, ratioElement) {
					
					if (widthMeasure.number) {
						this.element.style.width = widthMeasure.number + widthMeasure.units;
					}

					// Here's the change, appending the child to shadowRoot instead
					this.element.shadowRoot.appendChild(ratioElement);
				}

				// destroy existing ratio element requires knowledge of the shadow dom
				PlaceholderVanilla.prototype.destroyExistingRatioElement = function() {

					var destroyQueue = this.element.shadowRoot.querySelectorAll('.' + this.RATIO_HEIGHT_ELEMENT_CLASS);

					[].slice.call(destroyQueue).forEach(function(element, i){
						element.parentNode.removeChild(element);
					});
				}

				this.generatePlaceholderVanilla();
			},

			generatePlaceholderVanilla: function() {
				
				var options = {
					'width': this.pwidth,
					'height': this.pheight,
					'ratio': this.pratio,
				};

				if (this.puseratio !== null && typeof this.puseratio == 'boolean') {
					options.useRatio = this.puseratio;
				}

				this.placeholderVanilla = new PlaceholderVanilla(this, options).applyDimensions();
			},

			pwidthChanged: function() {
				this.attrChanged();
			},

			pheightChanged: function() {
				this.attrChanged();
			},

			pratioChanged: function() {
				this.attrChanged();
			},

			attrChanged: function() {
				this.placeholderVanilla = null; // kill old one
				this.generatePlaceholderVanilla(); // regenerate with new options
			},
	    });

	</script>
</polymer-element>